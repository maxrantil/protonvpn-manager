#!/bin/bash
# ABOUTME: Shared utility functions for VPN scripts
# ABOUTME: Provides logging and notification functions used across components

# Simple notification function for basic feedback
# Usage: notify_event "event_type" ["arg1"] ["arg2"]
# Output: [INFO] event_type: arg1 arg2
notify_event() {
    local event_type="$1"
    local arg1="${2:-}"
    local arg2="${3:-}"
    echo "[INFO] $event_type: $arg1 $arg2" >&2
}

# Log message function with timestamp
# Usage: log_message "message" "log_file_path"
# Format: [YYYY-MM-DD HH:MM:SS] message
# Note: If log_file is omitted, outputs to stderr only
log_message() {
    local message="$1"
    local log_file="${2:-}"

    local timestamp
    timestamp="[$(date '+%Y-%m-%d %H:%M:%S')]"

    # If no log file specified, output to stderr only
    if [[ -z "$log_file" ]]; then
        echo "$timestamp $message" >&2
        return 0
    fi

    # Try to write to log file
    if echo "$timestamp $message" >> "$log_file" 2> /dev/null; then
        return 0
    else
        # Fallback to stderr if log file not writable
        echo "$timestamp $message" >&2
        return 0
    fi
}

# Export functions for use in other scripts
export -f notify_event
export -f log_message
