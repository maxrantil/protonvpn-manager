# Docker test environment for Artix Linux
FROM artixlinux/artixlinux:latest

# Install dependencies
RUN pacman -Syu --noconfirm && \
    pacman -S --noconfirm openvpn curl bc sudo git

# Create test user (non-root for realistic testing)
RUN useradd -m -s /bin/bash testuser && \
    echo "testuser ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers

# Set working directory
WORKDIR /app

# Copy VPN manager source
COPY . /app/

# Switch to test user
USER testuser

# Default command runs install + smoke tests
CMD ["bash", "-c", "./install.sh && ./tests/smoke/run_smoke_tests.sh"]
